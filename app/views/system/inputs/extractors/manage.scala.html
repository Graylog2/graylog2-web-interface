@(currentUser: org.graylog2.restclient.models.User, breadcrumbs: lib.BreadcrumbList, node: org.graylog2.restclient.models.Node, input: org.graylog2.restclient.models.Input, extractors: List[org.graylog2.restclient.models.Extractor])
@import org.graylog2.restclient.models.Extractor
@main("Extractors", null, "", currentUser, false) {

    @views.html.partials.breadcrumbs(breadcrumbs)

    <div class="row content content-head">
        <div class="col-md-10">
           <h1>
                Extractors of <em>@input.getTitle</em>
           </h1>

            <p class="description">
                Extractors are applied on every message that is received by this input. Use them to extract and transform
                any text data into fields that allow you easy filtering and analysis later on.
                Example: Extract the HTTP response code from a log message, transform it to a numeric field and attach it
                as <em>http_response_code</em> to the message.
            </p>
        </div>

        <div class="col-md-2" style="margin-top: 10px; text-align: right;">
            <div class="btn-group">
                <a class="btn btn-info btn-lg dropdown-toggle" data-toggle="dropdown" href="#">
                    Actions
                    <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="@routes.ExtractorsController.importExtractorsPage(node.getNodeId, input.getId)">Import extractors</a></li>
                    <li><a href="@routes.ExtractorsController.exportExtractors(node.getNodeId, input.getId)">Export extractors</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div id="react-add-extractor" data-input-id="@input.getId"></div>

    @*Extractor list*@
    <div class="row content xtrc-list-container">
        <div class="col-md-12">
        <h2>
            Configured extractors

            <small>
                Change execution order by dragging on the icons.
            </small>
        </h2>

        @if(extractors.size() > 0) {
            <ul class="xtrc-list-drag list-unstyled" data-input-persist-id="@input.getPersistId">
            @for(extractor <- extractors.sortBy(_.getOrder)) {
                <li id="@extractor.getId">
                <div class="node-row">
                    <h3>
                        <i class="fa fa-reorder xtrc-order-handle"></i>
                        <strong>@extractor.getTitle</strong> (@extractor.getType().toHumanReadable)

                        @if(extractor.getTotalExceptions > 0) {
                            <span class="badge badge-important xtrc-exception-bubble" data-extractor-id="@extractor.getId">
                                @extractor.getTotalExceptions
                            </span>
                        }
                    </h3>

                    <span class="pull-right node-row-info node-row-info-negative-correction">
                        <button class="btn btn-info extractor-show-details" type="button" data-extractor-id="@extractor.getId">
                                Details
                        </button>

                        <form action="@routes.ExtractorsController.editExtractor(node.getNodeId, input.getId, extractor.getId)" method="GET">
                            <button class="btn btn-info" type="submit">Edit</button>
                        </form>

                        <form action="@routes.ExtractorsController.delete(node.getNodeId, input.getId, extractor.getId)" method="POST">
                            <button class="btn btn-danger" type="submit" data-confirm="Really remove extractor?">
                                Remove
                            </button>
                        </form>
                    </span>

                    <div class="extractor-row-summary">
                        @views.html.system.inputs.extractors.partials.extractor_summary(extractor)
                    </div>

                    <div class="extractor-details-@extractor.getId" style="display: none;">

                        @if(extractor.getTotalExceptions > 0) {
                            <div class="alert alert-danger">
                                <i class="fa fa-exclamation-triangle"></i>
                                This extractor has thrown <em>@extractor.getExceptions</em> exception@if(extractor.getExceptions != 1) {s}
                                during extraction and <em>@extractor.getConverterExceptions</em>
                                exception@if(extractor.getConverterExceptions != 1) {s}

                                while converting.

                                Please check the server logs for error messages because exceptions can have a severe
                                performance impact and should be avoided.
                            </div>
                        }

                        <div class="well well-small">
                            <div class="xtrc-config">
                                <h4>Configuration:</h4>
                                <ul>
                                    @for((k,v) <- extractor.getExtractorConfig) {
                                        <li>
                                            @k:
                                            @if(v.equals(" ")){
                                               [whitespace]
                                            } else {
                                                @v
                                            }
                                        </li>
                                    }
                                </ul>
                            </div>

                            @if(!extractor.getConverters().isEmpty) {
                                <div class="xtrc-converters">
                                    <h4>Converters</h4>
                                    <ul>
                                        @for(converter <- extractor.getConverters) {
                                            <li>@converter.getType</li>

                                            @if(!converter.getConfig.isEmpty) {
                                                <ul class="xtrc-converter-config">
                                                    @for((k,v) <- converter.getConfig) {
                                                        <li>
                                                            @k:
                                                            @if(v.equals(" ")){
                                                                [whitespace]
                                                             } else {
                                                                @v
                                                             }
                                                        </li>
                                                    }
                                                </ul>
                                            }
                                        }
                                    </ul>
                                </div>
                            }
                        </div>

                        @views.html.system.inputs.extractors.partials.extractor_conditions(extractor)

                        @views.html.system.inputs.extractors.partials.extractor_metrics(extractor.getMetrics)

                    </div>
                </div>
                </li>
            }
            </ul>
        } else {
            <div class="alert alert-danger">This input has no configured extractors.</div>
        }
        </div>
    </div>

}
